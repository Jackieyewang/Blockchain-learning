{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.decodeCleartext = exports.prepareCleartext = exports.decodeIdentityCID = exports.encodeIdentityCID = exports.encodePayload = void 0;\n\nconst ipld_dag_cbor_1 = __importDefault(require(\"ipld-dag-cbor\"));\n\nconst cids_1 = __importDefault(require(\"cids\"));\n\nconst multihashes_1 = __importDefault(require(\"multihashes\"));\n\nconst u8a = __importStar(require(\"uint8arrays\"));\n\nconst varint_1 = __importDefault(require(\"varint\"));\n\nconst DAG_CBOR_CODE = 113;\nconst ID_MULTIHASH = 0;\nconst ENC_BLOCK_SIZE = 24;\n\nfunction encodePayload(payload) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const block = new Uint8Array(ipld_dag_cbor_1.default.util.serialize(payload));\n    return {\n      cid: yield ipld_dag_cbor_1.default.util.cid(block),\n      linkedBlock: block\n    };\n  });\n}\n\nexports.encodePayload = encodePayload;\n\nfunction pad(b, blockSize = ENC_BLOCK_SIZE) {\n  const padLen = (blockSize - b.length % blockSize) % blockSize;\n  return u8a.concat([b, new Uint8Array(padLen)]);\n}\n\nfunction unpadCIDBytes(b) {\n  let offset = 0;\n  let mhLen;\n\n  for (let i = 0; i < 4; i++) {\n    mhLen = varint_1.default.decode(b, offset);\n    offset += varint_1.default.decode.bytes;\n  }\n\n  return new cids_1.default(b.slice(0, offset + mhLen));\n}\n\nfunction encodeIdentityCID(obj) {\n  const block = ipld_dag_cbor_1.default.util.serialize(obj);\n  const idMultiHash = multihashes_1.default.encode(block, ID_MULTIHASH);\n  return new cids_1.default(1, DAG_CBOR_CODE, idMultiHash);\n}\n\nexports.encodeIdentityCID = encodeIdentityCID;\n\nfunction decodeIdentityCID(cid) {\n  cids_1.default.validateCID(cid);\n  if (cid.code !== DAG_CBOR_CODE) throw new Error('CID codec must be dag-cbor');\n  const {\n    code,\n    digest\n  } = multihashes_1.default.decode(cid.multihash);\n  if (code !== ID_MULTIHASH) throw new Error('CID must use identity multihash');\n  return ipld_dag_cbor_1.default.util.deserialize(digest);\n}\n\nexports.decodeIdentityCID = decodeIdentityCID;\n\nfunction prepareCleartext(cleartext, blockSize) {\n  return pad(encodeIdentityCID(cleartext).bytes, blockSize);\n}\n\nexports.prepareCleartext = prepareCleartext;\n\nfunction decodeCleartext(b) {\n  return decodeIdentityCID(unpadCIDBytes(b));\n}\n\nexports.decodeCleartext = decodeCleartext;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAA,eAAA,GAAA,eAAA,CAAA,OAAA,CAAA,eAAA,CAAA,CAAA;;AACA,MAAA,MAAA,GAAA,eAAA,CAAA,OAAA,CAAA,MAAA,CAAA,CAAA;;AACA,MAAA,aAAA,GAAA,eAAA,CAAA,OAAA,CAAA,aAAA,CAAA,CAAA;;AACA,MAAA,GAAA,GAAA,YAAA,CAAA,OAAA,CAAA,aAAA,CAAA,CAAA;;AACA,MAAA,QAAA,GAAA,eAAA,CAAA,OAAA,CAAA,QAAA,CAAA,CAAA;;AAEA,MAAM,aAAa,GAAG,GAAtB;AACA,MAAM,YAAY,GAAG,CAArB;AACA,MAAM,cAAc,GAAG,EAAvB;;AAOA,SAAsB,aAAtB,CAAoC,OAApC,EAAgE;;AAC9D,UAAM,KAAK,GAAG,IAAI,UAAJ,CAAe,eAAA,CAAA,OAAA,CAAQ,IAAR,CAAa,SAAb,CAAuB,OAAvB,CAAf,CAAd;AACA,WAAO;AACL,MAAA,GAAG,EAAE,MAAM,eAAA,CAAA,OAAA,CAAQ,IAAR,CAAa,GAAb,CAAiB,KAAjB,CADN;AAEL,MAAA,WAAW,EAAE;AAFR,KAAP;AAID,G;AAAA;;AAND,OAAA,CAAA,aAAA,GAAA,aAAA;;AAQA,SAAS,GAAT,CAAa,CAAb,EAA4B,SAAS,GAAG,cAAxC,EAAsD;AAIpD,QAAM,MAAM,GAAG,CAAC,SAAS,GAAI,CAAC,CAAC,MAAF,GAAW,SAAzB,IAAuC,SAAtD;AAGA,SAAO,GAAG,CAAC,MAAJ,CAAW,CAAC,CAAD,EAAI,IAAI,UAAJ,CAAe,MAAf,CAAJ,CAAX,CAAP;AACD;;AAED,SAAS,aAAT,CAAuB,CAAvB,EAAoC;AAGlC,MAAI,MAAM,GAAG,CAAb;AACA,MAAI,KAAJ;;AACA,OAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,GAAG,CAApB,EAAuB,CAAC,EAAxB,EAA4B;AAC1B,IAAA,KAAK,GAAG,QAAA,CAAA,OAAA,CAAO,MAAP,CAAc,CAAd,EAAiB,MAAjB,CAAR;AACA,IAAA,MAAM,IAAI,QAAA,CAAA,OAAA,CAAO,MAAP,CAAc,KAAxB;AACD;;AAED,SAAO,IAAI,MAAA,CAAA,OAAJ,CAAQ,CAAC,CAAC,KAAF,CAAQ,CAAR,EAAW,MAAM,GAAG,KAApB,CAAR,CAAP;AACD;;AAED,SAAgB,iBAAhB,CAAkC,GAAlC,EAA0D;AACxD,QAAM,KAAK,GAAG,eAAA,CAAA,OAAA,CAAQ,IAAR,CAAa,SAAb,CAAuB,GAAvB,CAAd;AACA,QAAM,WAAW,GAAG,aAAA,CAAA,OAAA,CAAY,MAAZ,CAAmB,KAAnB,EAA0B,YAA1B,CAApB;AACA,SAAO,IAAI,MAAA,CAAA,OAAJ,CAAQ,CAAR,EAAW,aAAX,EAA0B,WAA1B,CAAP;AACD;;AAJD,OAAA,CAAA,iBAAA,GAAA,iBAAA;;AAMA,SAAgB,iBAAhB,CAAkC,GAAlC,EAA0C;AACxC,EAAA,MAAA,CAAA,OAAA,CAAI,WAAJ,CAAgB,GAAhB;AACA,MAAI,GAAG,CAAC,IAAJ,KAAa,aAAjB,EAAgC,MAAM,IAAI,KAAJ,CAAU,4BAAV,CAAN;AAChC,QAAM;AAAE,IAAA,IAAF;AAAQ,IAAA;AAAR,MAAmB,aAAA,CAAA,OAAA,CAAY,MAAZ,CAAmB,GAAG,CAAC,SAAvB,CAAzB;AACA,MAAI,IAAI,KAAK,YAAb,EAA2B,MAAM,IAAI,KAAJ,CAAU,iCAAV,CAAN;AAC3B,SAAO,eAAA,CAAA,OAAA,CAAQ,IAAR,CAAa,WAAb,CAAyB,MAAzB,CAAP;AACD;;AAND,OAAA,CAAA,iBAAA,GAAA,iBAAA;;AAQA,SAAgB,gBAAhB,CAAiC,SAAjC,EAAiE,SAAjE,EAAmF;AACjF,SAAO,GAAG,CAAC,iBAAiB,CAAC,SAAD,CAAjB,CAA6B,KAA9B,EAAqC,SAArC,CAAV;AACD;;AAFD,OAAA,CAAA,gBAAA,GAAA,gBAAA;;AAIA,SAAgB,eAAhB,CAAgC,CAAhC,EAA6C;AAC3C,SAAO,iBAAiB,CAAC,aAAa,CAAC,CAAD,CAAd,CAAxB;AACD;;AAFD,OAAA,CAAA,eAAA,GAAA,eAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.decodeCleartext = exports.prepareCleartext = exports.decodeIdentityCID = exports.encodeIdentityCID = exports.encodePayload = void 0;\nconst ipld_dag_cbor_1 = __importDefault(require(\"ipld-dag-cbor\"));\nconst cids_1 = __importDefault(require(\"cids\"));\nconst multihashes_1 = __importDefault(require(\"multihashes\"));\nconst u8a = __importStar(require(\"uint8arrays\"));\nconst varint_1 = __importDefault(require(\"varint\"));\nconst DAG_CBOR_CODE = 113;\nconst ID_MULTIHASH = 0;\nconst ENC_BLOCK_SIZE = 24;\nfunction encodePayload(payload) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const block = new Uint8Array(ipld_dag_cbor_1.default.util.serialize(payload));\n        return {\n            cid: yield ipld_dag_cbor_1.default.util.cid(block),\n            linkedBlock: block,\n        };\n    });\n}\nexports.encodePayload = encodePayload;\nfunction pad(b, blockSize = ENC_BLOCK_SIZE) {\n    const padLen = (blockSize - (b.length % blockSize)) % blockSize;\n    return u8a.concat([b, new Uint8Array(padLen)]);\n}\nfunction unpadCIDBytes(b) {\n    let offset = 0;\n    let mhLen;\n    for (let i = 0; i < 4; i++) {\n        mhLen = varint_1.default.decode(b, offset);\n        offset += varint_1.default.decode.bytes;\n    }\n    return new cids_1.default(b.slice(0, offset + mhLen));\n}\nfunction encodeIdentityCID(obj) {\n    const block = ipld_dag_cbor_1.default.util.serialize(obj);\n    const idMultiHash = multihashes_1.default.encode(block, ID_MULTIHASH);\n    return new cids_1.default(1, DAG_CBOR_CODE, idMultiHash);\n}\nexports.encodeIdentityCID = encodeIdentityCID;\nfunction decodeIdentityCID(cid) {\n    cids_1.default.validateCID(cid);\n    if (cid.code !== DAG_CBOR_CODE)\n        throw new Error('CID codec must be dag-cbor');\n    const { code, digest } = multihashes_1.default.decode(cid.multihash);\n    if (code !== ID_MULTIHASH)\n        throw new Error('CID must use identity multihash');\n    return ipld_dag_cbor_1.default.util.deserialize(digest);\n}\nexports.decodeIdentityCID = decodeIdentityCID;\nfunction prepareCleartext(cleartext, blockSize) {\n    return pad(encodeIdentityCID(cleartext).bytes, blockSize);\n}\nexports.prepareCleartext = prepareCleartext;\nfunction decodeCleartext(b) {\n    return decodeIdentityCID(unpadCIDBytes(b));\n}\nexports.decodeCleartext = decodeCleartext;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}