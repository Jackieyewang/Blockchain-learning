{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StreamStatic = exports.Stream = exports.CommitType = exports.AnchorStatus = exports.SignatureStatus = void 0;\n\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\n\nconst streamid_1 = require(\"@ceramicnetwork/streamid\");\n\nconst rxjs_1 = require(\"rxjs\");\n\nconst docopts_1 = require(\"./docopts\");\n\nvar SignatureStatus;\n\n(function (SignatureStatus) {\n  SignatureStatus[SignatureStatus[\"GENESIS\"] = 0] = \"GENESIS\";\n  SignatureStatus[SignatureStatus[\"PARTIAL\"] = 1] = \"PARTIAL\";\n  SignatureStatus[SignatureStatus[\"SIGNED\"] = 2] = \"SIGNED\";\n})(SignatureStatus = exports.SignatureStatus || (exports.SignatureStatus = {}));\n\nvar AnchorStatus;\n\n(function (AnchorStatus) {\n  AnchorStatus[AnchorStatus[\"NOT_REQUESTED\"] = 0] = \"NOT_REQUESTED\";\n  AnchorStatus[AnchorStatus[\"PENDING\"] = 1] = \"PENDING\";\n  AnchorStatus[AnchorStatus[\"PROCESSING\"] = 2] = \"PROCESSING\";\n  AnchorStatus[AnchorStatus[\"ANCHORED\"] = 3] = \"ANCHORED\";\n  AnchorStatus[AnchorStatus[\"FAILED\"] = 4] = \"FAILED\";\n})(AnchorStatus = exports.AnchorStatus || (exports.AnchorStatus = {}));\n\nvar CommitType;\n\n(function (CommitType) {\n  CommitType[CommitType[\"GENESIS\"] = 0] = \"GENESIS\";\n  CommitType[CommitType[\"SIGNED\"] = 1] = \"SIGNED\";\n  CommitType[CommitType[\"ANCHOR\"] = 2] = \"ANCHOR\";\n})(CommitType = exports.CommitType || (exports.CommitType = {}));\n\nclass Stream extends rxjs_1.Observable {\n  constructor(state$, _context) {\n    super(subscriber => {\n      state$.subscribe(subscriber);\n    });\n    this.state$ = state$;\n    this._context = _context;\n  }\n\n  get id() {\n    return new streamid_1.StreamID(this.state$.value.type, this.state$.value.log[0].cid);\n  }\n\n  get api() {\n    return this._context.api;\n  }\n\n  get metadata() {\n    var _a;\n\n    const {\n      next,\n      metadata\n    } = this.state$.value;\n    return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.metadata) !== null && _a !== void 0 ? _a : metadata);\n  }\n\n  get controllers() {\n    return this.metadata.controllers;\n  }\n\n  get tip() {\n    return this.state$.value.log[this.state$.value.log.length - 1].cid;\n  }\n\n  get commitId() {\n    return this.id.atCommit(this.tip);\n  }\n\n  get allCommitIds() {\n    return this.state$.value.log.map(({\n      cid\n    }) => this.id.atCommit(cid));\n  }\n\n  get anchorCommitIds() {\n    return this.state$.value.log.filter(({\n      type\n    }) => type === CommitType.ANCHOR).map(({\n      cid\n    }) => this.id.atCommit(cid));\n  }\n\n  get state() {\n    return lodash_clonedeep_1.default(this.state$.value);\n  }\n\n  async sync(opts = {}) {\n    opts = {\n      sync: docopts_1.SyncOptions.PREFER_CACHE,\n      ...opts\n    };\n    const stream = await this.api.loadStream(this.id, opts);\n    this.state$.next(stream.state);\n  }\n\n  _getContent() {\n    var _a;\n\n    const {\n      next,\n      content\n    } = this.state$.value;\n    return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.content) !== null && _a !== void 0 ? _a : content);\n  }\n\n}\n\nexports.Stream = Stream;\n\nfunction StreamStatic() {\n  return constructor => {\n    constructor;\n  };\n}\n\nexports.StreamStatic = StreamStatic;","map":{"version":3,"sources":["../src/stream.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StreamStatic = exports.Stream = exports.CommitType = exports.AnchorStatus = exports.SignatureStatus = void 0;\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nconst streamid_1 = require(\"@ceramicnetwork/streamid\");\nconst rxjs_1 = require(\"rxjs\");\nconst docopts_1 = require(\"./docopts\");\nvar SignatureStatus;\n(function (SignatureStatus) {\n    SignatureStatus[SignatureStatus[\"GENESIS\"] = 0] = \"GENESIS\";\n    SignatureStatus[SignatureStatus[\"PARTIAL\"] = 1] = \"PARTIAL\";\n    SignatureStatus[SignatureStatus[\"SIGNED\"] = 2] = \"SIGNED\";\n})(SignatureStatus = exports.SignatureStatus || (exports.SignatureStatus = {}));\nvar AnchorStatus;\n(function (AnchorStatus) {\n    AnchorStatus[AnchorStatus[\"NOT_REQUESTED\"] = 0] = \"NOT_REQUESTED\";\n    AnchorStatus[AnchorStatus[\"PENDING\"] = 1] = \"PENDING\";\n    AnchorStatus[AnchorStatus[\"PROCESSING\"] = 2] = \"PROCESSING\";\n    AnchorStatus[AnchorStatus[\"ANCHORED\"] = 3] = \"ANCHORED\";\n    AnchorStatus[AnchorStatus[\"FAILED\"] = 4] = \"FAILED\";\n})(AnchorStatus = exports.AnchorStatus || (exports.AnchorStatus = {}));\nvar CommitType;\n(function (CommitType) {\n    CommitType[CommitType[\"GENESIS\"] = 0] = \"GENESIS\";\n    CommitType[CommitType[\"SIGNED\"] = 1] = \"SIGNED\";\n    CommitType[CommitType[\"ANCHOR\"] = 2] = \"ANCHOR\";\n})(CommitType = exports.CommitType || (exports.CommitType = {}));\nclass Stream extends rxjs_1.Observable {\n    constructor(state$, _context) {\n        super(subscriber => {\n            state$.subscribe(subscriber);\n        });\n        this.state$ = state$;\n        this._context = _context;\n    }\n    get id() {\n        return new streamid_1.StreamID(this.state$.value.type, this.state$.value.log[0].cid);\n    }\n    get api() {\n        return this._context.api;\n    }\n    get metadata() {\n        var _a;\n        const { next, metadata } = this.state$.value;\n        return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.metadata) !== null && _a !== void 0 ? _a : metadata);\n    }\n    get controllers() {\n        return this.metadata.controllers;\n    }\n    get tip() {\n        return this.state$.value.log[this.state$.value.log.length - 1].cid;\n    }\n    get commitId() {\n        return this.id.atCommit(this.tip);\n    }\n    get allCommitIds() {\n        return this.state$.value.log.map(({ cid }) => this.id.atCommit(cid));\n    }\n    get anchorCommitIds() {\n        return this.state$.value.log\n            .filter(({ type }) => type === CommitType.ANCHOR)\n            .map(({ cid }) => this.id.atCommit(cid));\n    }\n    get state() {\n        return lodash_clonedeep_1.default(this.state$.value);\n    }\n    async sync(opts = {}) {\n        opts = { sync: docopts_1.SyncOptions.PREFER_CACHE, ...opts };\n        const stream = await this.api.loadStream(this.id, opts);\n        this.state$.next(stream.state);\n    }\n    _getContent() {\n        var _a;\n        const { next, content } = this.state$.value;\n        return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.content) !== null && _a !== void 0 ? _a : content);\n    }\n}\nexports.Stream = Stream;\nfunction StreamStatic() {\n    return (constructor) => { constructor; };\n}\nexports.StreamStatic = StreamStatic;\n//# sourceMappingURL=stream.js.map"]},"metadata":{},"sourceType":"script"}