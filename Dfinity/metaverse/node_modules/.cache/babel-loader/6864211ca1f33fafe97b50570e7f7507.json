{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst did_provider_1 = require(\"./did-provider\");\n\nconst three_idx_1 = require(\"./three-idx\");\n\nconst permissions_1 = __importStar(require(\"./permissions\"));\n\nconst keychain_1 = require(\"./keychain\");\n\nclass ThreeIdProvider {\n  constructor(_threeIdx, _permissions, _keychain) {\n    this._threeIdx = _threeIdx;\n    this._permissions = _permissions;\n    this._keychain = _keychain;\n  }\n\n  get keychain() {\n    return this._keychain;\n  }\n\n  get permissions() {\n    return this._permissions;\n  }\n\n  get id() {\n    return this._threeIdx.id;\n  }\n\n  static create(config) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      if (config.seed && config.authSecret) throw new Error(\"Can't use both seed and authSecret\");\n      if (!config.seed && !config.authSecret) throw new Error('Either seed or authSecret is needed');\n\n      if (config.authSecret && !config.authId) {\n        throw new Error('AuthId must be given along with authSecret');\n      }\n\n      if (config.authId && config.disableIDX) {\n        throw new Error('AuthId cannot be used with disableIDX');\n      }\n\n      const threeIdx = new three_idx_1.ThreeIDX(config.ceramic);\n      const permissions = new permissions_1.default(config.getPermission);\n\n      const makeTmpProvider = (keyring, forcedDID) => {\n        return new did_provider_1.DidProvider({\n          keyring,\n          permissions,\n          threeIdx,\n          forcedOrigin: permissions_1.SELF_ORIGIN,\n          forcedDID\n        });\n      };\n\n      let keychain;\n\n      if (config.seed) {\n        if (typeof config.seed === 'string') throw new Error('seed needs to be Uint8Array');\n\n        if (config.did) {\n          keychain = yield keychain_1.Keychain.loadFromSeed(threeIdx, config.seed, config.did, makeTmpProvider);\n        } else {\n          keychain = yield keychain_1.Keychain.create(threeIdx, makeTmpProvider, config.seed, config.v03ID);\n        }\n      } else if (config.authSecret) {\n        keychain = yield keychain_1.Keychain.load(threeIdx, config.authSecret, makeTmpProvider);\n      }\n\n      permissions.setDID(threeIdx.id);\n      const idw = new ThreeIdProvider(threeIdx, permissions, keychain);\n      yield idw._threeIdx.setDIDProvider(idw.getDidProvider(permissions_1.SELF_ORIGIN));\n\n      if (config.authId && !((_a = yield keychain === null || keychain === void 0 ? void 0 : keychain.list()) === null || _a === void 0 ? void 0 : _a.length)) {\n        yield idw.keychain.add(config.authId, config.authSecret);\n        yield idw.keychain.commit();\n      }\n\n      if (idw._threeIdx.docs.idx == null && !config.disableIDX) {\n        yield idw._threeIdx.createIDX();\n      }\n\n      return idw;\n    });\n  }\n\n  getDidProvider(forcedOrigin) {\n    return new did_provider_1.DidProvider({\n      keyring: this.keychain._keyring,\n      permissions: this.permissions,\n      threeIdx: this._threeIdx,\n      forcedOrigin\n    });\n  }\n\n}\n\nexports.default = ThreeIdProvider;","map":{"version":3,"sources":["../src/threeid-provider.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst did_provider_1 = require(\"./did-provider\");\nconst three_idx_1 = require(\"./three-idx\");\nconst permissions_1 = __importStar(require(\"./permissions\"));\nconst keychain_1 = require(\"./keychain\");\nclass ThreeIdProvider {\n    constructor(_threeIdx, _permissions, _keychain) {\n        this._threeIdx = _threeIdx;\n        this._permissions = _permissions;\n        this._keychain = _keychain;\n    }\n    get keychain() {\n        return this._keychain;\n    }\n    get permissions() {\n        return this._permissions;\n    }\n    get id() {\n        return this._threeIdx.id;\n    }\n    static create(config) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (config.seed && config.authSecret)\n                throw new Error(\"Can't use both seed and authSecret\");\n            if (!config.seed && !config.authSecret)\n                throw new Error('Either seed or authSecret is needed');\n            if (config.authSecret && !config.authId) {\n                throw new Error('AuthId must be given along with authSecret');\n            }\n            if (config.authId && config.disableIDX) {\n                throw new Error('AuthId cannot be used with disableIDX');\n            }\n            const threeIdx = new three_idx_1.ThreeIDX(config.ceramic);\n            const permissions = new permissions_1.default(config.getPermission);\n            const makeTmpProvider = (keyring, forcedDID) => {\n                return new did_provider_1.DidProvider({\n                    keyring,\n                    permissions,\n                    threeIdx,\n                    forcedOrigin: permissions_1.SELF_ORIGIN,\n                    forcedDID,\n                });\n            };\n            let keychain;\n            if (config.seed) {\n                if (typeof config.seed === 'string')\n                    throw new Error('seed needs to be Uint8Array');\n                if (config.did) {\n                    keychain = yield keychain_1.Keychain.loadFromSeed(threeIdx, config.seed, config.did, makeTmpProvider);\n                }\n                else {\n                    keychain = yield keychain_1.Keychain.create(threeIdx, makeTmpProvider, config.seed, config.v03ID);\n                }\n            }\n            else if (config.authSecret) {\n                keychain = yield keychain_1.Keychain.load(threeIdx, config.authSecret, makeTmpProvider);\n            }\n            permissions.setDID(threeIdx.id);\n            const idw = new ThreeIdProvider(threeIdx, permissions, keychain);\n            yield idw._threeIdx.setDIDProvider(idw.getDidProvider(permissions_1.SELF_ORIGIN));\n            if (config.authId && !((_a = (yield (keychain === null || keychain === void 0 ? void 0 : keychain.list()))) === null || _a === void 0 ? void 0 : _a.length)) {\n                yield idw.keychain.add(config.authId, config.authSecret);\n                yield idw.keychain.commit();\n            }\n            if (idw._threeIdx.docs.idx == null && !config.disableIDX) {\n                yield idw._threeIdx.createIDX();\n            }\n            return idw;\n        });\n    }\n    getDidProvider(forcedOrigin) {\n        return new did_provider_1.DidProvider({\n            keyring: this.keychain._keyring,\n            permissions: this.permissions,\n            threeIdx: this._threeIdx,\n            forcedOrigin,\n        });\n    }\n}\nexports.default = ThreeIdProvider;\n//# sourceMappingURL=threeid-provider.js.map"]},"metadata":{},"sourceType":"script"}